# 코드 정리의 일괄 처리량

## 설명

> "코드 정리의 크기가 어느 정도일 때 쉽게 통합하고 배포할 수 있을까요?"

다음과 같은 방법들이 존재할 거에요.

- 모든 코드 정리를 한꺼번에 한다.
- 각각의 코드정리를 개별적으로 한다.
- 몇 개는 묶되, 몇 개는 개별적으로 한다.

그렇다면 어떤 방법이 가장 좋은 걸까요?

저자는 **골디락스 딜레마**를 언급하며 **충돌, 상호작용, 추측과의 상관관계**를 주목했어요.

### 작업 당 코드 정리가 많아진다면

- 다른 작업자와의 작업에서의 **충돌의 크기가 커질 가능성이 높아요**. 그렇다면 병합하는 데에 대한 소요 시간도 늘어나죠.
- 변경에 있어, 다른 코드와 상호작용이 있는 코드의 동작 변경으로 인해 **사이드 이펙트가 발생할 확률이 높아요**. 이는 큰 프로젝트일 수록 발견하기 어려워져요.
- 더 많은 코드를 정리하게 되면서, 다량의 코드를 변경함으로 인해 **다른 리뷰어가 추측해야 하는 정도가 커져요**.

### 작업 당 코드 정리가 적어진다면

## [예시] 디렉토리 구조 재설계

### [문제] 작업당 코드가 너무 많은 상황

이전에, 디렉토리 구조를 재설계하면서 하나의 PR에 합쳐 메인 브랜치에 merge를 시도한 적이 있었어요.

![before](https://github.com/user-attachments/assets/1d0cd494-f9ac-4362-9578-feda61ad220b)

하지만, 해당 서비스는 비즈니스 생명주기 중 도입기였기 때문에 정책이 자주 바뀌었어요.

결국 200파일, 4000줄이 넘어가는 PR은 충돌의 크기를 감당하기 어려웠기에, 결국 머지하지 못했어요.

### [해결] PR을 단위 별로 나누어 처리

이를 해결하기 위해, 하나하나의 작업마다 PR을 나누어 머지를 시도했어요.

각 인원이 시간이 날 때마다 별도의 브랜치에서 1 ~ 2개의 변경 당 하나의 PR을 올리게끔 관리를 한 것이었죠.

결과적으로, 약 28개의 PR로 쪼개어졌는데요.  
이렇게 분리된 PR은 다음과 같은 효과가 있었어요.

1. QA가 용이해졌어요. 이전의 코드들이 수많은 페이지에서 검수를 해야 했다면, 변경된 건은 몇 개의 컴포넌트만 보더라도 문제가 없는지 파악이 가능했어요. 이를 통해, 쉽게 머지할 수 있었어요.
2. 리뷰에 대한 품질이 높아졌어요. 기존의 PR은 그 크기가 4000줄임에 비해, 피드백은 고작 2개밖에 없었어요. 반면, 쪼개진 PR에서는 많으면 10개까지도 나오는 만큼, 리뷰에 대한 품질과 신뢰도가 높아졌어요.

![after](https://github.com/user-attachments/assets/8944c59a-c785-46d0-a5a9-a374eac38689)

따라서 코드 정리에 대한 부담감 없이 쉽게 머지하고, 안정적으로 1주일 만에 기능 분할 설계에 맞춰 디렉토리 구조를 변경했어요 😁

## 사유

PR을 잘게 쪼갠다는 것도 중요하지만, 저는 **어떻게 PR을 쪼개도록 설계할 것인가**를 이야기했으면 더욱 좋았을 것 같다는 생각이 들었어요.

너무나 무거운 PR을 보면 화나기도 하지만, 사실 근본적으로는 **왜 이 작업자는 크게 PR을 올려야만 했을까**를 생각해요.

이는 기술적인 한계에 부딪혔을 수도 있고, 또는 회사 문화나 환경에서는 이러한 불편함을 느끼지 않아도 되는 경우도 있을 수 있죠.

그래서, 이 챕터에 대해 공감이 되면서도, 조직 관점에서의 이야기가 1줄 밖에 없었다는 점이 아쉽기도 했답니다 🥲

## 참고자료

[에어비앤비는 어떻게 리액트를 점진적으로 업그레이드했을까?](https://velog.io/@typo/how-airbnb-smoothly-upgrades-react)

마이그레이션에서 큰 변경을 모듈 별칭과 아티팩트 분리, 테스트에 대한 낙관적인 포용을 통해 점진적으로 업그레이드한 사례에요.

## 발제

위의 사유나 참고자료에서, 기술적인 한계나 문화, 환경에서의 문제로 인해 PR을 쪼개지 않는 경우가 있을 수도 있다고 언급했는데요!

기술적인 문제는 계속해서 개발 실력을 갈고 닦으면 되지만, 다른 문제는 조직적인 차원에서 함께 해결해야 하는 것 같아요.

어떻게 이러한 PR 크기 관련 문제를, 스스로 해결할 수 있게끔 조직의 문화나 환경 속에서 유도할 수 있을까요?
